{% extends "blog/base.html" %}

{% block title %}{{ object.headline|safe }}{% endblock %}
{% block body_class %}{{ block.super }} post_detail{% endblock %}
{% block body_id %}post_{{ object.id }}{% endblock %}

{% block content_title %}
  <h2>{{ object.headline|safe }}</h2>
  <p class="other_posts">
    {% if object.get_previous_by_pub_date %}
    <a class="previous" href="{{ object.get_previous_post.get_absolute_url }}">&laquo; {{ object.get_previous_post|safe }}</a> {% endif %}
    {% if object.get_next_by_pub_date %}
	| <a class="next" href="{{ object.get_next_post.get_absolute_url }}">{{ object.get_next_post|safe }} &raquo;</a> 
    {% endif %}
  </p>
{% endblock %}

{% block content %}
	{% load comments %}
	<div class="article{% if not object.is_published %} draft{% endif %}" >
		<div class="article_header" >
			<h1 class="topic">{% if not object.is_published %}Draft: {% endif %}{{ object.headline|safe }}</h1>
			<h2 class="date">{{ object.pub_date|date:"l, j F Y G:i T" }}</h2>
			<h3 class="author">Posted by: 
				<a href="{{ object.author.get_absolute_url}}">{{ object.author }}</a>
			</h3>
			<h4 class="category">
				{% for tag in object.tags.all %}
					<a href="{{ tag.get_absolute_url }}">#{{ tag.tag }}</a>
				{% endfor %}
			</h4>
			{% if perms.blog.change_entry %}
				<a href="{% url admin:blog_entry_change object.id %}">Edit</a>
			{% endif %} 

		</div>
		<div class="content" >
			{{ object.content|safe }} 
		</div>
		<div class="article_footer" >
			Last modified: {{ object.modified|date:"l, j F Y G:i T" }}
		</div>
		<div class="article_comments" >

  {% get_comment_list for object as comment_list %}
  {% if comment_list %}
  <div id="comments">
    <a name="comments"></a>
    <h3 class="comments_title">Comments</h3>
    {% for comment in comment_list %}
      {% if comment.is_public %}
      <div class="comment">
        <h5 class="name">
          <a name="c{{ comment.id }}" href="{{ comment.get_absolute_url }}" title="Permalink to {{ comment.person_name }}'s comment"
class="count">{{ forloop.counter }}</a> 
          {% if comment.user_url %}<a href="{{ comment.user_url }}">{{ comment.user_name }}</a>{% else %}{{ comment.user_name }}{% endif %}
says...
        </h5>
        {{ comment.comment|safe|removetags:"a"|urlize }}
        <p class="date">Posted at {{ comment.submit_date|date:"P" }} on {{ comment.submit_date|date:"F j, Y" }}</p>
      </div>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
  {% if object.can_comment %}
    {% render_comment_form for object %}
  {% else %}
    <div id="comment_form">
      <h3>Comments are closed.</h3>
      <p>Comments have been closed for this post.</p>
    </div>
  {% endif %}

		</div>
	</div>
{% endblock %}
